
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard - Mines Game</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: Arial;
    background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    min-height: 100vh;
    padding: 20px;
}
.container {
    max-width: 1200px;
    margin: 0 auto;
    background: rgba(255,255,255,0.95);
    border-radius: 20px;
    padding: 30px;
}
h1 {
    color: #1e3c72;
    margin-bottom: 20px;
    text-align: center;
}
h2 {
    color: #2c5364;
    margin: 30px 0 15px 0;
    padding-bottom: 10px;
    border-bottom: 2px solid #FFD700;
}
.tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}
.tab {
    padding: 12px 24px;
    background: #1e3c72;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
}
.tab.active {
    background: #FFD700;
    color: #000;
}
.tab-content {
    display: none;
}
.tab-content.active {
    display: block;
}
table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
    background: white;
}
th {
    background: #1e3c72;
    color: white;
    padding: 12px;
    text-align: left;
}
td {
    padding: 12px;
    border-bottom: 1px solid #ddd;
}
tr:hover {
    background: #f5f5f5;
}
button {
    padding: 8px 16px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    margin: 2px;
}
.btn-approve {
    background: #4CAF50;
    color: white;
}
.btn-reject {
    background: #f44336;
    color: white;
}
.btn-edit {
    background: #2196F3;
    color: white;
}
.status-pending {
    color: #FF9800;
    background: rgba(255,152,0,0.2);
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 12px;
}
.status-approved {
    color: #4CAF50;
    background: rgba(76,175,80,0.2);
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 12px;
}
.status-rejected {
    color: #f44336;
    background: rgba(244,67,54,0.2);
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 12px;
}
.stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin: 20px 0;
}
.stat-card {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
}
.stat-value {
    font-size: 32px;
    font-weight: bold;
    margin: 10px 0;
}
.stat-label {
    font-size: 14px;
    opacity: 0.9;
}
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    justify-content: center;
    align-items: center;
    z-index: 1000;
}
.modal-content {
    background: white;
    padding: 30px;
    border-radius: 15px;
    max-width: 500px;
    width: 90%;
}
.modal-content h3 {
    margin-bottom: 20px;
    color: #1e3c72;
}
.modal-content input {
    width: 100%;
    padding: 10px;
    margin: 10px 0;
    border: 2px solid #ddd;
    border-radius: 5px;
}
.modal-buttons {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}
.no-data {
    text-align: center;
    padding: 40px;
    color: #999;
    font-style: italic;
}
</style>
</head>
<body>

<div class="container">
    <h1>ðŸŽ® MINES GAME - ADMIN DASHBOARD</h1>
    
    <div class="stats">
        <div class="stat-card" style="background: linear-gradient(135deg, #667eea, #764ba2);">
            <div class="stat-label">Total Users</div>
            <div class="stat-value" id="totalUsers">0</div>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
            <div class="stat-label">Pending Deposits</div>
            <div class="stat-value" id="pendingDeposits">0</div>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">
            <div class="stat-label">Pending Withdrawals</div>
            <div class="stat-value" id="pendingWithdraws">0</div>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #43e97b, #38f9d7);">
            <div class="stat-label">Total Balance</div>
            <div class="stat-value">Rs <span id="totalBalance">0</span></div>
        </div>
    </div>
    
    <div class="tabs">
        <button class="tab active" onclick="showTab('users')">ðŸ‘¥ Users</button>
        <button class="tab" onclick="showTab('deposits')">ðŸ’° Deposit Requests</button>
        <button class="tab" onclick="showTab('withdraws')">ðŸ’¸ Withdraw Requests</button>
        <button class="tab" onclick="showTab('history')">ðŸ“Š History</button>
    </div>
    
    <!-- USERS TAB -->
    <div id="users" class="tab-content active">
        <h2>All Users</h2>
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Phone</th>
                    <th>Balance</th>
                    <th>Total Deposit</th>
                    <th>Total Withdraw</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="usersTable"></tbody>
        </table>
    </div>
    
    <!-- DEPOSITS TAB -->
    <div id="deposits" class="tab-content">
        <h2>Deposit Requests</h2>
        <table>
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Name</th>
                    <th>Phone</th>
                    <th>Amount</th>
                    <th>Transaction ID</th>
                    <th>Note</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="depositsTable"></tbody>
        </table>
    </div>
    
    <!-- WITHDRAWS TAB -->
    <div id="withdraws" class="tab-content">
        <h2>Withdraw Requests</h2>
        <table>
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Name</th>
                    <th>Phone</th>
                    <th>JazzCash Number</th>
                    <th>Amount</th>
                    <th>Note</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="withdrawsTable"></tbody>
        </table>
    </div>
    
    <!-- HISTORY TAB -->
    <div id="history" class="tab-content">
        <h2>Approved Transactions</h2>
        <div id="historyContent"></div>
    </div>
</div>

<!-- Edit Balance Modal -->
<div id="editBalanceModal" class="modal">
    <div class="modal-content">
        <h3>Edit User Balance</h3>
        <p><strong>User:</strong> <span id="editUserName"></span></p>
        <p><strong>Phone:</strong> <span id="editUserPhone"></span></p>
        <p><strong>Current Balance:</strong> Rs <span id="editCurrentBalance"></span></p>
        <label>New Balance (Rs):</label>
        <input type="number" id="editNewBalance" placeholder="Enter new balance">
        <div class="modal-buttons">
            <button class="btn-approve" onclick="saveBalance()">Save</button>
            <button class="btn-reject" onclick="closeModal()">Cancel</button>
        </div>
    </div>
</div>

<script>
let currentEditUser = null;

// STORAGE HELPERS
function getData(key) {
    const data = localStorage.getItem(key);
    return data ? JSON.parse(data) : null;
}

function setData(key, value) {
    localStorage.setItem(key, JSON.stringify(value));
}

function getAllUsers() {
    return getData('allUsers') || {};
}

function getRequests(type) {
    return getData(type + 'Requests') || [];
}

function saveRequests(type, requests) {
    setData(type + 'Requests', requests);
}

// TAB SWITCHING
function showTab(tabName) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    event.target.classList.add('active');
    document.getElementById(tabName).classList.add('active');
    loadData();
}

// LOAD DATA
function loadData() {
    loadUsers();
    loadDeposits();
    loadWithdraws();
    loadHistory();
    updateStats();
}

function updateStats() {
    const users = getAllUsers();
    const deposits = getRequests('deposit');
    const withdraws = getRequests('withdraw');
    
    const userCount = Object.keys(users).length;
    const pendingDep = deposits.filter(d => d.status === 'pending').length;
    const pendingWith = withdraws.filter(w => w.status === 'pending').length;
    const totalBal = Object.values(users).reduce((sum, u) => sum + (u.balance || 0), 0);
    
    document.getElementById('totalUsers').textContent = userCount;
    document.getElementById('pendingDeposits').textContent = pendingDep;
    document.getElementById('pendingWithdraws').textContent = pendingWith;
    document.getElementById('totalBalance').textContent = totalBal;
}

function loadUsers() {
    const users = getAllUsers();
    const tbody = document.getElementById('usersTable');
    tbody.innerHTML = '';
    
    if (Object.keys(users).length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="no-data">No users yet</td></tr>';
        return;
    }
    
    Object.values(users).forEach(user => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${user.name}</td>
            <td>${user.phone}</td>
            <td>Rs ${user.balance || 0}</td>
            <td>Rs ${user.totalDeposit || 0}</td>
            <td>Rs ${user.totalWithdraw || 0}</td>
            <td>
                <button class="btn-edit" onclick="editBalance('${user.phone}')">Edit Balance</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

function loadDeposits() {
    const deposits = getRequests('deposit');
    const tbody = document.getElementById('depositsTable');
    tbody.innerHTML = '';
    
    if (deposits.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" class="no-data">No deposit requests</td></tr>';
        return;
    }
    
    deposits.reverse().forEach(dep => {
        const date = new Date(dep.timestamp).toLocaleString();
        const status = dep.status === 'pending' ? 'status-pending' : 
                      dep.status === 'approved' ? 'status-approved' : 'status-rejected';
        
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${date}</td>
            <td>${dep.name}</td>
            <td>${dep.phone}</td>
            <td>Rs ${dep.amount}</td>
            <td>${dep.txId}</td>
            <td>${dep.note || '-'}</td>
            <td><span class="${status}">${dep.status}</span></td>
            <td>
                ${dep.status === 'pending' ? `
                    <button class="btn-approve" onclick="approveDeposit(${dep.id})">Approve</button>
                    <button class="btn-reject" onclick="rejectDeposit(${dep.id})">Reject</button>
                ` : '-'}
            </td>
        `;
        tbody.appendChild(tr);
    });
}

function loadWithdraws() {
    const withdraws = getRequests('withdraw');
    const tbody = document.getElementById('withdrawsTable');
    tbody.innerHTML = '';
    
    if (withdraws.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" class="no-data">No withdraw requests</td></tr>';
        return;
    }
    
    withdraws.reverse().forEach(wit => {
        const date = new Date(wit.timestamp).toLocaleString();
        const status = wit.status === 'pending' ? 'status-pending' : 
                      wit.status === 'approved' ? 'status-approved' : 'status-rejected';
        
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${date}</td>
            <td>${wit.name}</td>
            <td>${wit.phone}</td>
            <td>${wit.jazzCash}</td>
            <td>Rs ${wit.amount}</td>
            <td>${wit.note || '-'}</td>
            <td><span class="${status}">${wit.status}</span></td>
            <td>
                ${wit.status === 'pending' ? `
                    <button class="btn-approve" onclick="approveWithdraw(${wit.id})">Approve</button>
                    <button class="btn-reject" onclick="rejectWithdraw(${wit.id})">Reject</button>
                ` : '-'}
            </td>
        `;
        tbody.appendChild(tr);
    });
}

function loadHistory() {
    const deposits = getRequests('deposit').filter(d => d.status === 'approved');
    const withdraws = getRequests('withdraw').filter(w => w.status === 'approved');
    
    const all = [...deposits, ...withdraws].sort((a, b) => 
        new Date(b.timestamp) - new Date(a.timestamp)
    );
    
    const div = document.getElementById('historyContent');
    
    if (all.length === 0) {
        div.innerHTML = '<div class="no-data">No transaction history</div>';
        return;
    }
    
    let html = '<table><thead><tr><th>Time</th><th>Type</th><th>User</th><th>Amount</th><th>Details</th></tr></thead><tbody>';
    
    all.forEach(item => {
        const type = item.txId ? 'DEPOSIT' : 'WITHDRAW';
        const details = item.txId ? `TX: ${item.txId}` : `To: ${item.jazzCash}`;
        html += `
            <tr>
                <td>${new Date(item.timestamp).toLocaleString()}</td>
                <td>${type}</td>
                <td>${item.name} (${item.phone})</td>
                <td>Rs ${item.amount}</td>
                <td>${details}</td>
            </tr>
        `;
    });
    
    html += '</tbody></table>';
    div.innerHTML = html;
}

// APPROVE/REJECT DEPOSIT
function approveDeposit(id) {
    if (!confirm('Approve this deposit? This will add balance to user account.')) return;
    
    const deposits = getRequests('deposit');
    const dep = deposits.find(d => d.id === id);
    if (!dep) return;
    
    // Update user balance
    const users = getAllUsers();
    if (users[dep.phone]) {
        users[dep.phone].balance += dep.amount;
        users[dep.phone].totalDeposit = (users[dep.phone].totalDeposit || 0) + dep.amount;
        setData('allUsers', users);
    }
    
    // Update request status
    dep.status = 'approved';
    dep.approvedAt = new Date().toISOString();
    saveRequests('deposit', deposits);
    
    alert('Deposit approved! User balance updated.');
    loadData();
}

function rejectDeposit(id) {
    const reason = prompt('Reject reason (optional):');
    
    const deposits = getRequests('deposit');
    const dep = deposits.find(d => d.id === id);
    if (!dep) return;
    
    dep.status = 'rejected';
    dep.rejectReason = reason || 'No reason provided';
    dep.rejectedAt = new Date().toISOString();
    saveRequests('deposit', deposits);
    
    alert('Deposit rejected.');
    loadData();
}

// APPROVE/REJECT WITHDRAW
function approveWithdraw(id) {
    const confirm1 = confirm('Step 1: Have you sent money to user JazzCash?');
    if (!confirm1) {
        alert('Please send money first, then approve.');
        return;
    }
    
    const confirm2 = confirm('Step 2: Confirm approval? User balance will be deducted.');
    if (!confirm2) return;
    
    const withdraws = getRequests('withdraw');
    const wit = withdraws.find(w => w.id === id);
    if (!wit) return;
    
    // Update user balance
    const users = getAllUsers();
    if (users[wit.phone]) {
        users[wit.phone].balance -= wit.amount;
        users[wit.phone].totalWithdraw = (users[wit.phone].totalWithdraw || 0) + wit.amount;
        setData('allUsers', users);
    }
    
    // Update request status
    wit.status = 'approved';
    wit.approvedAt = new Date().toISOString();
    saveRequests('withdraw', withdraws);
    
    alert('Withdraw approved! User balance deducted.');
    loadData();
}

function rejectWithdraw(id) {
    const reason = prompt('Reject reason (optional):');
    
    const withdraws = getRequests('withdraw');
    const wit = withdraws.find(w => w.id === id);
    if (!wit) return;
    
    wit.status = 'rejected';
    wit.rejectReason = reason || 'No reason provided';
    wit.rejectedAt = new Date().toISOString();
    saveRequests('withdraw', withdraws);
    
    alert('Withdraw rejected.');
    loadData();
}

// EDIT BALANCE
function editBalance(phone) {
    const users = getAllUsers();
    const user = users[phone];
    if (!user) return;
    
    currentEditUser = phone;
    document.getElementById('editUserName').textContent = user.name;
    document.getElementById('editUserPhone').textContent = user.phone;
    document.getElementById('editCurrentBalance').textContent = user.balance || 0;
    document.getElementById('editNewBalance').value = user.balance || 0;
    document.getElementById('editBalanceModal').style.display = 'flex';
}

function saveBalance() {
    const newBalance = parseInt(document.getElementById('editNewBalance').value);
    if (isNaN(newBalance) || newBalance < 0) {
        alert('Invalid balance!');
        return;
    }
    
    const users = getAllUsers();
    if (users[currentEditUser]) {
        users[currentEditUser].balance = newBalance;
        setData('allUsers', users);
        alert('Balance updated!');
        closeModal();
        loadData();
    }
}

function closeModal() {
    document.getElementById('editBalanceModal').style.display = 'none';
    currentEditUser = null;
}

// AUTO REFRESH
setInterval(loadData, 5000); // Refresh every 5 seconds

// INIT
loadData();
</script>

</body>
</html>
