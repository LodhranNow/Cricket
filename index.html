<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mines Game - Card Edition</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CSS VARIABLES & RESET
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --gold:          #f0c040;
  --gold-dim:      #c89a28;
  --neon-cyan:     #22d3ee;
  --neon-emerald:  #34d399;
  --neon-amber:    #fbbf24;
  --neon-rose:     #fb7185;
  --neon-blue:     #60a5fa;
  --neon-teal:     #2dd4bf;
  --bg-deep:       #0a0c14;
  --card-bg:       rgba(18, 22, 40, 0.85);
  --card-border:   rgba(255,255,255,0.08);
  --card-shadow:   0 8px 32px rgba(0,0,0,0.32);
  --text-primary:  #f0f0f5;
  --text-muted:    #9aa0b8;
  --radius-lg:     18px;
  --radius-md:     14px;
  --radius-sm:     10px;
  --spacing-card:  20px;
  --spacing-section: 16px;
}

* { margin:0; padding:0; box-sizing:border-box; }

html, body {
  height:100%; min-height:100vh;
  font-family:'Rajdhani', sans-serif;
  background: var(--bg-deep);
  color: var(--text-primary);
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BACKGROUND & CANVAS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.background-gradient {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: radial-gradient(ellipse at top, rgba(26, 32, 64, 0.4) 0%, rgba(10, 12, 20, 0.9) 70%);
  z-index: -1;
}

.noise-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
  background-size: 200px;
  opacity: 0.02;
  z-index: -1;
  pointer-events: none;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN CONTAINER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.main-container {
  max-width: 480px;
  width: 100%;
  margin: 0 auto;
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: var(--spacing-section);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARD STYLES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card {
  background: var(--card-bg);
  backdrop-filter: blur(20px) saturate(1.5);
  -webkit-backdrop-filter: blur(20px) saturate(1.5);
  border: 1px solid var(--card-border);
  border-radius: var(--radius-lg);
  box-shadow: var(--card-shadow),
              inset 0 1px 0 rgba(255,255,255,0.05);
  padding: var(--spacing-card);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
  box-shadow: 0 12px 40px rgba(0,0,0,0.4),
              inset 0 1px 0 rgba(255,255,255,0.08);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER CARD
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.header-card {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
}

.user-info {
  flex: 1;
}

.user-name {
  font-family: 'Orbitron', sans-serif;
  font-size: 18px;
  font-weight: 700;
  color: var(--gold);
  letter-spacing: 1px;
  margin-bottom: 4px;
  text-shadow: 0 0 10px rgba(240,192,64,0.3);
}

.user-phone {
  font-size: 14px;
  color: var(--text-muted);
  font-weight: 500;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOGOUT BUTTON
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.logout-btn {
  background: rgba(251,113,133,0.1);
  border: 1.5px solid rgba(251,113,133,0.3);
  color: var(--neon-rose);
  padding: 10px 18px;
  border-radius: var(--radius-sm);
  font-family: 'Rajdhani', sans-serif;
  font-size: 14px;
  font-weight: 600;
  letter-spacing: 1px;
  cursor: pointer;
  transition: all 0.25s ease;
  text-transform: uppercase;
}

.logout-btn:hover {
  background: rgba(251,113,133,0.2);
  border-color: rgba(251,113,133,0.5);
  box-shadow: 0 0 20px rgba(251,113,133,0.2);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTION CARD
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.action-card {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
  padding: 20px;
}

.action-btn {
  padding: 18px 12px;
  border-radius: var(--radius-md);
  font-family: 'Rajdhani', sans-serif;
  font-size: 16px;
  font-weight: 700;
  letter-spacing: 1.2px;
  cursor: pointer;
  border: none;
  transition: all 0.25s ease;
  text-transform: uppercase;
  text-align: center;
  position: relative;
  overflow: hidden;
}

.action-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.action-btn:not(:disabled):hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 24px rgba(0,0,0,0.3);
}

.action-btn:not(:disabled):active {
  transform: translateY(-1px);
}

/* Deposit Button */
.deposit-btn {
  background: linear-gradient(135deg, rgba(52,211,153,0.15), rgba(52,211,153,0.08));
  border: 1.5px solid rgba(52,211,153,0.4);
  color: var(--neon-emerald);
}

.deposit-btn:not(:disabled):hover {
  background: linear-gradient(135deg, rgba(52,211,153,0.25), rgba(52,211,153,0.15));
  border-color: rgba(52,211,153,0.6);
  box-shadow: 0 0 24px rgba(52,211,153,0.2);
}

/* Withdraw Button */
.withdraw-btn {
  background: linear-gradient(135deg, rgba(251,191,36,0.15), rgba(251,191,36,0.08));
  border: 1.5px solid rgba(251,191,36,0.4);
  color: var(--neon-amber);
}

.withdraw-btn:not(:disabled):hover {
  background: linear-gradient(135deg, rgba(251,191,36,0.25), rgba(251,191,36,0.15));
  border-color: rgba(251,191,36,0.6);
  box-shadow: 0 0 24px rgba(251,191,36,0.2);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATS CARD
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.stats-card {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  padding: 20px;
}

.stat-item {
  text-align: center;
}

.stat-label {
  font-size: 12px;
  color: var(--text-muted);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 8px;
  font-weight: 600;
}

.stat-value {
  font-family: 'Orbitron', sans-serif;
  font-size: 28px;
  font-weight: 700;
  color: var(--gold);
  text-shadow: 0 0 12px rgba(240,192,64,0.4);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GAME GRID CARD
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.game-grid-card {
  padding: 24px;
}

.grid-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 24px;
  text-align: center;
  margin-bottom: 20px;
  color: var(--gold);
  letter-spacing: 3px;
  text-transform: uppercase;
}

.grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 8px;
  margin: 0 auto;
  max-width: 320px;
}

.tile {
  aspect-ratio: 1;
  background: linear-gradient(145deg, rgba(28,34,56,0.9), rgba(18,22,40,0.95));
  border: 1.5px solid rgba(255,255,255,0.1);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  cursor: pointer;
  transition: all 0.25s cubic-bezier(0.34,1.56,0.64,1);
  position: relative;
  overflow: hidden;
  user-select: none;
}

.tile:not(.revealed):hover {
  transform: scale(1.08);
  border-color: rgba(34,211,238,0.5);
  box-shadow: 0 0 20px rgba(34,211,238,0.2),
              inset 0 0 12px rgba(34,211,238,0.1);
}

.tile.revealed {
  cursor: default;
}

.tile.safe {
  background: linear-gradient(145deg, rgba(240,192,64,0.25), rgba(251,191,36,0.15));
  border-color: rgba(240,192,64,0.6);
  animation: revealSafe 0.3s ease-out;
}

.tile.mine {
  background: linear-gradient(145deg, rgba(251,113,133,0.3), rgba(220,20,60,0.2));
  border-color: rgba(251,113,133,0.7);
  animation: revealMine 0.4s ease-out;
}

@keyframes revealSafe {
  0% { transform: scale(0.9); opacity: 0.6; }
  100% { transform: scale(1); opacity: 1; }
}

@keyframes revealMine {
  0% { transform: scale(1); }
  50% { transform: scale(1.15); }
  100% { transform: scale(1); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONTROL CARD
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.control-card {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  padding: 20px;
}

.control-btn {
  padding: 16px 10px;
  border-radius: var(--radius-md);
  font-family: 'Rajdhani', sans-serif;
  font-size: 15px;
  font-weight: 700;
  letter-spacing: 1px;
  cursor: pointer;
  border: none;
  transition: all 0.25s ease;
  text-align: center;
  position: relative;
  overflow: hidden;
}

.control-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.control-btn:not(:disabled):hover {
  transform: translateY(-2px);
}

.control-btn:not(:disabled):active {
  transform: translateY(0);
}

/* Left Side - Green/Teal Buttons */
.control-left {
  background: linear-gradient(135deg, rgba(52,211,153,0.15), rgba(52,211,153,0.08));
  border: 1.5px solid rgba(52,211,153,0.4);
  color: var(--neon-emerald);
}

.control-left:not(:disabled):hover {
  background: linear-gradient(135deg, rgba(52,211,153,0.25), rgba(52,211,153,0.15));
  border-color: rgba(52,211,153,0.6);
  box-shadow: 0 0 20px rgba(52,211,153,0.2);
}

/* Cashout Button - Primary Green */
#cashoutBtn {
  background: linear-gradient(135deg, rgba(52,211,153,0.2), rgba(52,211,153,0.1));
  border: 1.5px solid rgba(52,211,153,0.5);
}

/* Reset Button - Teal/Cyan */
#resetBtn {
  background: linear-gradient(135deg, rgba(45,212,191,0.15), rgba(45,212,191,0.08));
  border: 1.5px solid rgba(45,212,191,0.4);
  color: var(--neon-teal);
}

#resetBtn:not(:disabled):hover {
  background: linear-gradient(135deg, rgba(45,212,191,0.25), rgba(45,212,191,0.15));
  border-color: rgba(45,212,191,0.6);
  box-shadow: 0 0 20px rgba(45,212,191,0.2);
}

/* Right Side - Amber/Red Buttons */
.control-right {
  background: linear-gradient(135deg, rgba(251,191,36,0.15), rgba(251,191,36,0.08));
  border: 1.5px solid rgba(251,191,36,0.4);
  color: var(--neon-amber);
}

.control-right:not(:disabled):hover {
  background: linear-gradient(135deg, rgba(251,191,36,0.25), rgba(251,191,36,0.15));
  border-color: rgba(251,191,36,0.6);
  box-shadow: 0 0 20px rgba(251,191,36,0.2);
}

/* Mines Button - Soft Red */
#minesBtn {
  background: linear-gradient(135deg, rgba(251,113,133,0.15), rgba(251,113,133,0.08));
  border: 1.5px solid rgba(251,113,133,0.4);
  color: var(--neon-rose);
}

#minesBtn:not(:disabled):hover {
  background: linear-gradient(135deg, rgba(251,113,133,0.25), rgba(251,113,133,0.15));
  border-color: rgba(251,113,133,0.6);
  box-shadow: 0 0 20px rgba(251,113,133,0.2);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PENDING STATUS CARDS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pending-card {
  display: none;
  padding: 16px;
  margin-top: -8px;
  border-top: 1px solid rgba(255,255,255,0.05);
}

.pending-card.active {
  display: block;
  animation: slideDown 0.3s ease;
}

.pending-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 12px;
}

.pending-icon {
  font-size: 18px;
}

.pending-title {
  font-size: 15px;
  font-weight: 600;
  color: var(--neon-emerald);
}

.pending-amount {
  font-family: 'Orbitron', sans-serif;
  font-size: 22px;
  font-weight: 700;
  color: var(--gold);
  margin-bottom: 8px;
}

.pending-details {
  font-size: 13px;
  color: var(--text-muted);
  line-height: 1.5;
}

.pending-timer {
  font-size: 12px;
  color: var(--neon-rose);
  margin-top: 8px;
  direction: rtl;
}

.withdraw-pending .pending-title {
  color: var(--neon-amber);
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MESSAGES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.message {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  padding: 14px 24px;
  border-radius: var(--radius-md);
  font-weight: 600;
  font-size: 15px;
  letter-spacing: 0.5px;
  z-index: 1000;
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  display: none;
  animation: slideIn 0.3s ease;
  max-width: 90%;
  text-align: center;
}

.message.success {
  background: rgba(52,211,153,0.15);
  border: 1.5px solid rgba(52,211,153,0.4);
  color: var(--neon-emerald);
}

.message.error {
  background: rgba(251,113,133,0.15);
  border: 1.5px solid rgba(251,113,133,0.4);
  color: var(--neon-rose);
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOGIN SCREEN
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.login-container {
  max-width: 440px;
  width: 90%;
  margin: 0 auto;
  padding: 40px 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
}

.login-card {
  background: var(--card-bg);
  backdrop-filter: blur(30px) saturate(1.5);
  -webkit-backdrop-filter: blur(30px) saturate(1.5);
  border: 1px solid var(--card-border);
  border-radius: var(--radius-lg);
  box-shadow: 0 20px 60px rgba(0,0,0,0.4),
              inset 0 1px 0 rgba(255,255,255,0.05);
  padding: 40px 30px;
  width: 100%;
}

.login-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 48px;
  font-weight: 900;
  text-align: center;
  margin-bottom: 8px;
  background: linear-gradient(135deg, #f0c040 0%, #fbbf24 45%, #f59e0b 75%, #f0c040 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-transform: uppercase;
  letter-spacing: 8px;
}

.login-subtitle {
  font-size: 14px;
  color: var(--text-muted);
  text-align: center;
  margin-bottom: 32px;
  letter-spacing: 2px;
  direction: rtl;
  font-weight: 500;
}

.login-input {
  width: 100%;
  padding: 16px 18px;
  margin: 12px 0;
  background: rgba(12,15,26,0.7);
  border: 1.5px solid rgba(255,255,255,0.1);
  border-radius: var(--radius-sm);
  font-family: 'Rajdhani', sans-serif;
  font-size: 16px;
  font-weight: 500;
  color: var(--text-primary);
  outline: none;
  transition: all 0.25s ease;
}

.login-input:focus {
  border-color: var(--neon-cyan);
  box-shadow: 0 0 16px rgba(34,211,238,0.2);
}

.login-input::placeholder {
  color: var(--text-muted);
}

.login-btn {
  width: 100%;
  padding: 18px;
  margin-top: 16px;
  background: linear-gradient(135deg, rgba(52,211,153,0.2), rgba(52,211,153,0.1));
  border: 1.5px solid rgba(52,211,153,0.5);
  border-radius: var(--radius-sm);
  font-family: 'Rajdhani', sans-serif;
  font-size: 17px;
  font-weight: 700;
  letter-spacing: 1.5px;
  color: var(--neon-emerald);
  cursor: pointer;
  transition: all 0.25s ease;
  text-transform: uppercase;
}

.login-btn:hover {
  background: linear-gradient(135deg, rgba(52,211,153,0.3), rgba(52,211,153,0.2));
  box-shadow: 0 0 24px rgba(52,211,153,0.2);
  transform: translateY(-2px);
}

.login-btn:active {
  transform: translateY(0);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODALS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(4,5,10,0.85);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  padding: 20px;
}

.modal-overlay.active {
  display: flex;
}

.modal-card {
  background: var(--card-bg);
  backdrop-filter: blur(30px) saturate(1.5);
  -webkit-backdrop-filter: blur(30px) saturate(1.5);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: var(--radius-lg);
  box-shadow: 0 25px 80px rgba(0,0,0,0.5);
  padding: 30px;
  max-width: 420px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
}

.modal-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 20px;
  font-weight: 700;
  color: var(--gold);
  margin-bottom: 24px;
  text-align: center;
  letter-spacing: 2px;
}

.modal-input {
  width: 100%;
  padding: 16px 18px;
  margin: 12px 0;
  background: rgba(12,15,26,0.7);
  border: 1.5px solid rgba(255,255,255,0.1);
  border-radius: var(--radius-sm);
  font-family: 'Rajdhani', sans-serif;
  font-size: 16px;
  font-weight: 500;
  color: var(--text-primary);
  outline: none;
  transition: all 0.25s ease;
}

.modal-input:focus {
  border-color: var(--neon-cyan);
  box-shadow: 0 0 16px rgba(34,211,238,0.2);
}

.modal-btn {
  width: 100%;
  padding: 16px;
  margin: 8px 0;
  border-radius: var(--radius-sm);
  font-family: 'Rajdhani', sans-serif;
  font-size: 16px;
  font-weight: 700;
  letter-spacing: 1.2px;
  cursor: pointer;
  border: none;
  transition: all 0.25s ease;
  text-transform: uppercase;
}

.modal-btn:hover {
  transform: translateY(-2px);
}

.modal-btn:active {
  transform: translateY(0);
}

.modal-btn-primary {
  background: linear-gradient(135deg, rgba(52,211,153,0.2), rgba(52,211,153,0.1));
  border: 1.5px solid rgba(52,211,153,0.5);
  color: var(--neon-emerald);
}

.modal-btn-primary:hover {
  background: linear-gradient(135deg, rgba(52,211,153,0.3), rgba(52,211,153,0.2));
  box-shadow: 0 0 20px rgba(52,211,153,0.2);
}

.modal-btn-secondary {
  background: rgba(251,113,133,0.1);
  border: 1.5px solid rgba(251,113,133,0.3);
  color: var(--neon-rose);
}

.modal-btn-secondary:hover {
  background: rgba(251,113,133,0.2);
  box-shadow: 0 0 20px rgba(251,113,133,0.15);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE DESIGN
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 480px) {
  .main-container {
    padding: 12px;
    gap: 12px;
  }
  
  .card {
    padding: 16px;
  }
  
  .user-name {
    font-size: 16px;
  }
  
  .stat-value {
    font-size: 24px;
  }
  
  .grid {
    gap: 6px;
  }
  
  .tile {
    font-size: 20px;
  }
  
  .login-title {
    font-size: 36px;
    letter-spacing: 4px;
  }
  
  .modal-card {
    padding: 24px;
  }
}

@media (max-width: 350px) {
  .action-btn,
  .control-btn {
    font-size: 13px;
    padding: 14px 8px;
  }
  
  .grid {
    gap: 4px;
  }
  
  .tile {
    font-size: 18px;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILITY CLASSES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hidden {
  display: none !important;
}

.text-center {
  text-align: center;
}

.mt-1 { margin-top: 4px; }
.mt-2 { margin-top: 8px; }
.mt-3 { margin-top: 12px; }
.mt-4 { margin-top: 16px; }

.mb-1 { margin-bottom: 4px; }
.mb-2 { margin-bottom: 8px; }
.mb-3 { margin-bottom: 12px; }
.mb-4 { margin-bottom: 16px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCROLLBAR
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
::-webkit-scrollbar {
  width: 6px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.1);
  border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255,255,255,0.15);
}
</style>
</head>
<body>

<!-- Background Elements -->
<div class="background-gradient"></div>
<div class="noise-overlay"></div>

<!-- Login Screen -->
<div id="loginScreen" class="login-container">
  <div class="login-card">
    <div class="login-title">MINES</div>
    <div class="login-subtitle">Ø§Ù¾Ù†Ø§ Ù†Ø§Ù… Ø§ÙˆØ± Ù†Ù…Ø¨Ø± Ù„Ú©Ú¾ÛŒÚº</div>
    
    <div id="loginMessage" class="message"></div>
    
    <input type="text" id="loginName" class="login-input" placeholder="Your Name" maxlength="50">
    <input type="tel" id="loginPhone" class="login-input" placeholder="03XXXXXXXXX" maxlength="11">
    
    <button class="login-btn" onclick="handleLogin()">LOGIN / Ù„Ø§Ú¯ Ø§Ù†</button>
  </div>
</div>

<!-- Game Screen -->
<div id="gameScreen" class="main-container hidden">
  
  <!-- Header Card -->
  <div class="card header-card">
    <div class="user-info">
      <div class="user-name" id="displayName">Guest Player</div>
      <div class="user-phone" id="displayPhone">03XXXXXXXXX</div>
    </div>
    <button class="logout-btn" onclick="handleLogout()">Logout</button>
  </div>
  
  <!-- Action Card -->
  <div class="card">
    <div class="action-card">
      <button id="depositBtn" class="action-btn deposit-btn" onclick="openDepositModal()">DEPOSIT</button>
      <button id="withdrawBtn" class="action-btn withdraw-btn" onclick="openWithdrawModal()">WITHDRAW</button>
    </div>
    
    <!-- Pending Deposit Status -->
    <div id="pendingDepositStatus" class="pending-card">
      <div class="pending-header">
        <span class="pending-icon">â³</span>
        <span class="pending-title">Deposit Pending</span>
      </div>
      <div class="pending-amount" id="pendingDepositAmount">Rs 0</div>
      <div class="pending-details">
        <div id="pendingDepositMethod"></div>
        <div class="pending-timer" id="depositLockTimer"></div>
      </div>
    </div>
    
    <!-- Pending Withdraw Status -->
    <div id="pendingWithdrawStatus" class="pending-card withdraw-pending">
      <div class="pending-header">
        <span class="pending-icon">â³</span>
        <span class="pending-title">Withdraw Pending</span>
      </div>
      <div class="pending-amount" id="pendingWithdrawAmount">Rs 0</div>
      <div class="pending-details">
        <div id="pendingWithdrawMethod"></div>
        <div id="pendingWithdrawNumber"></div>
      </div>
    </div>
  </div>
  
  <!-- Stats Card -->
  <div class="card stats-card">
    <div class="stat-item">
      <div class="stat-label">Balance</div>
      <div class="stat-value">Rs <span id="balance">0</span></div>
    </div>
    <div class="stat-item">
      <div class="stat-label">Current Win</div>
      <div class="stat-value">Rs <span id="win">0</span></div>
    </div>
  </div>
  
  <!-- Game Grid Card -->
  <div class="card game-grid-card">
    <div class="grid-title">MINES GAME</div>
    <div class="grid" id="gameGrid"></div>
  </div>
  
  <!-- Control Card -->
  <div class="card control-card">
    <!-- Left Column -->
    <button id="cashoutBtn" class="control-btn control-left" onclick="cashout()" disabled>CASHOUT</button>
    <button id="resetBtn" class="control-btn control-left" onclick="resetGame()">RESET</button>
    
    <!-- Right Column -->
    <button id="betBtn" class="control-btn control-right" onclick="openBetModal()">BET RS <span id="betDisplay">0</span></button>
    <button id="minesBtn" class="control-btn control-right" onclick="openMinesModal()">ğŸ’£ MINES: <span id="minesDisplay">3</span></button>
  </div>
</div>

<!-- Global Message Display -->
<div id="globalMessage" class="message"></div>

<!-- Modals -->
<div id="depositModal" class="modal-overlay">
  <div class="modal-card">
    <div class="modal-title">Deposit Request</div>
    <div class="payment-method-toggle mb-4">
      <!-- Payment method toggle will be added by JS -->
    </div>
    <div class="payment-number-display mb-4" onclick="copyDepositNumber()">
      <!-- Payment number will be added by JS -->
    </div>
    <input type="number" id="depositAmount" class="modal-input" placeholder="Amount (Minimum Rs 500)" min="500">
    <div id="depositCooldown" class="pending-timer mb-4" style="display: none;"></div>
    <button class="modal-btn modal-btn-primary" onclick="submitDeposit()">Submit Request</button>
    <button class="modal-btn modal-btn-secondary" onclick="closeModal('depositModal')">Cancel</button>
  </div>
</div>

<div id="withdrawModal" class="modal-overlay">
  <div class="modal-card">
    <div class="modal-title">Withdraw Request</div>
    <div class="payment-method-toggle mb-4">
      <!-- Payment method toggle will be added by JS -->
    </div>
    <input type="tel" id="withdrawPhone" class="modal-input" placeholder="03XXXXXXXXX" maxlength="11">
    <input type="number" id="withdrawAmount" class="modal-input" placeholder="Amount (Minimum Rs 1000)" min="1000">
    <div id="withdrawCooldown" class="pending-timer mb-4" style="display: none;"></div>
    <button class="modal-btn modal-btn-primary" onclick="submitWithdraw()">Submit Request</button>
    <button class="modal-btn modal-btn-secondary" onclick="closeModal('withdrawModal')">Cancel</button>
  </div>
</div>

<div id="betModal" class="modal-overlay">
  <div class="modal-card">
    <div class="modal-title">Set Bet Amount</div>
    <input type="number" id="betInput" class="modal-input" placeholder="Amount (Rs 100 â€“ 10,000)" min="100" max="10000">
    <button class="modal-btn modal-btn-primary" onclick="setBet()">Set Bet</button>
    <button class="modal-btn modal-btn-secondary" onclick="closeModal('betModal')">Cancel</button>
  </div>
</div>

<div id="minesModal" class="modal-overlay">
  <div class="modal-card">
    <div class="modal-title">ğŸ’£ Set Mines Count</div>
    <input type="number" id="minesInput" class="modal-input" placeholder="Mines (1â€“24)" min="1" max="24" value="3">
    <button class="modal-btn modal-btn-secondary" onclick="setMines()">Set Mines</button>
    <button class="modal-btn modal-btn-primary" onclick="closeModal('minesModal')">Cancel</button>
  </div>
</div>

<!-- Kicked Overlay -->
<div id="kickedOverlay" class="modal-overlay">
  <div class="modal-card">
    <div style="text-align: center; margin-bottom: 24px;">
      <div style="font-size: 60px; margin-bottom: 16px;">ğŸš«</div>
      <div class="modal-title" style="color: var(--neon-rose);">SESSION TERMINATED</div>
    </div>
    <div style="text-align: center; color: var(--text-muted); line-height: 1.6;">
      Your session has been terminated. Please contact support if you believe this is an error.
    </div>
  </div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getDatabase, ref, set, get, update, onValue, push, serverTimestamp }
  from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

const firebaseConfig = {
  apiKey: "AIzaSyA8C1-TpsRo0UsATshlI8Dy0v40PnLRlc4",
  authDomain: "mines-67d8c.firebaseapp.com",
  databaseURL: "https://mines-67d8c-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "mines-67d8c",
  storageBucket: "mines-67d8c.firebasestorage.app",
  messagingSenderId: "918317634273",
  appId: "1:918317634273:web:8527c0d58a1f3de0371da0",
  measurementId: "G-NHC6K1X3KZ"
};

const app = initializeApp(firebaseConfig);
const database = getDatabase(app);

window.db = database;
window.dbRef = ref;
window.dbSet = set;
window.dbGet = get;
window.dbUpdate = update;
window.dbOnValue = onValue;
window.dbPush = push;
window.dbServerTimestamp = serverTimestamp;

if (window._fbResolve) window._fbResolve();
console.log('âœ… Firebase initialized successfully!');
</script>

<!-- Main Game Script -->
<script>
// Wait for Firebase to be ready
window._fbReady = new Promise(r => { window._fbResolve = r; });
async function fbReady() { await window._fbReady; }

// Game State
let gameState = {
  userId: null,
  userName: '',
  userPhone: '',
  balance: 0,
  currentBet: 0,
  currentWin: 0,
  minesCount: 3,
  gameActive: false,
  minePositions: [],
  revealedTiles: [],
  betSet: false,
  tilesClicked: false
};

// Deposit/Withdraw State
let depositMethod = 'jazz';
let withdrawMethod = 'jazz';
let depositLockTimer = null;

// Sound Effects
const sounds = {
  click: new Audio('data:audio/wav;base64,UklGRhIAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU4AAAB/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/'),
  success: new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YWAAAAB/gH+Af4B/gH+Af4B/gH+Af4B/gH+Af4B/gH+Af4B/gH+Af4B/gH+Af4B/gH+Af4B/'),
  error: new Audio('data:audio/wav;base64,UklGRh4AAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YVoAAACAf39/gICAf39/gIB/f39/f4CAf39/gH+Af4B/gH+Af39/f3+Af4B/gH+Af39/'),
  win: new Audio('data:audio/wav;base64,UklGRjIAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YW4AAAB/gICAgICBgYGCgoKDg4OEhISFhYWGhoaHh4eIiIiJiYmKioqLi4uMjIyNjY2Ojo6Pj4+QkJCRkZGSkpI='),
  mine: new Audio('data:audio/wav;base64,UklGRiYAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YWIAAACAfn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+')
};

// Preload sounds
Object.values(sounds).forEach(sound => {
  sound.volume = 0.4;
  sound.load();
});

// Win Rate Table
const WIN_RATES = {
  1: 0.02, 2: 0.05, 3: 0.10, 4: 0.20, 5: 0.40,
  6: 0.60, 7: 0.70, 8: 0.80, 9: 0.90, 10: 1.00,
  11: 1.10, 12: 1.20, 13: 1.30, 14: 1.40, 15: 1.50,
  16: 1.60, 17: 1.70, 18: 1.80, 19: 1.90, 20: 2.00,
  21: 2.20, 22: 2.50, 23: 3.00, 24: 4.00,
};

function getWinRate() { return WIN_RATES[gameState.minesCount] || 0.10; }

// Utility Functions
function showMessage(text, type = 'success') {
  const messageEl = document.getElementById('globalMessage');
  messageEl.textContent = text;
  messageEl.className = `message ${type}`;
  messageEl.style.display = 'block';
  
  setTimeout(() => {
    messageEl.style.display = 'none';
  }, 3000);
}

function playSound(soundName) {
  try {
    if (sounds[soundName]) {
      sounds[soundName].currentTime = 0;
      sounds[soundName].volume = 0.4;
      sounds[soundName].play().catch(e => console.log('Sound blocked:', e));
    }
  } catch (e) {
    console.log('Sound error:', e);
  }
}

function closeModal(modalId) {
  document.getElementById(modalId).classList.remove('active');
}

// Device Fingerprint
function getDeviceFingerprint() {
  const n = navigator, s = window.screen;
  return btoa(`${n.userAgent}_${s.width}x${s.height}_${s.colorDepth}_${n.language}`).substring(0, 32);
}

// Firebase Helpers
async function saveUserData(phone, data) {
  await fbReady();
  try {
    await window.dbSet(window.dbRef(window.db, `users/${phone}`), {
      ...data,
      lastUpdated: window.dbServerTimestamp()
    });
    return true;
  } catch (e) {
    console.error(e);
    return false;
  }
}

async function getUserData(phone) {
  await fbReady();
  try {
    const snap = await window.dbGet(window.dbRef(window.db, `users/${phone}`));
    return snap.exists() ? snap.val() : null;
  } catch (e) {
    console.error(e);
    return null;
  }
}

async function updateUserBalance(phone, bal) {
  await fbReady();
  try {
    await window.dbUpdate(window.dbRef(window.db, `users/${phone}`), {
      balance: bal,
      lastUpdated: window.dbServerTimestamp()
    });
    return true;
  } catch (e) {
    console.error(e);
    return false;
  }
}

function listenToUserData(phone) {
  window.dbOnValue(window.dbRef(window.db, `users/${phone}`), snap => {
    if (!snap.exists()) return;
    const d = snap.val();
    
    // Check if banned
    if (d.banned) {
      showKickedScreen();
      return;
    }
    
    // Check if kicked
    const currentDeviceId = getDeviceFingerprint();
    if (!d.isOnline || (d.deviceId && d.deviceId !== currentDeviceId)) {
      showKickedScreen();
      return;
    }
    
    gameState.balance = d.balance || 0;
    updateDisplay();
  });
}

// Login System
async function handleLogin() {
  playSound('click');
  await fbReady();
  
  const name = document.getElementById('loginName').value.trim();
  const phone = document.getElementById('loginPhone').value.trim();
  
  if (!name) {
    showMessage('Please enter your name!', 'error');
    return;
  }
  
  if (!/^03[0-9]{9}$/.test(phone)) {
    showMessage('Invalid phone! Must be 03XXXXXXXXX', 'error');
    return;
  }
  
  showMessage('Logging inâ€¦', 'success');
  
  const deviceId = getDeviceFingerprint();
  const namePairKey = `${name}_${phone}`;
  
  try {
    // Check banned phones
    const bannedPhoneSnap = await window.dbGet(window.dbRef(window.db, `bannedPhones/${phone}`));
    if (bannedPhoneSnap.exists()) {
      setTimeout(() => showKickedScreen(), 500);
      return;
    }
    
    // Check user data
    const userSnap = await window.dbGet(window.dbRef(window.db, `users/${phone}`));
    if (userSnap.exists()) {
      const userData = userSnap.val();
      
      if (userData.banned) {
        showKickedScreen();
        return;
      }
      
      if (userData.isOnline && userData.deviceId && userData.deviceId !== deviceId) {
        showMessage('Account already logged in on another device!', 'error');
        return;
      }
      
      if (userData.name !== name) {
        showMessage('Name does not match registered name!', 'error');
        return;
      }
    }
    
    // Update user data
    const now = Date.now();
    const updates = {};
    
    if (!userSnap.exists()) {
      updates[`users/${phone}`] = {
        name,
        phone,
        balance: 0,
        totalDeposit: 0,
        totalWithdraw: 0,
        createdAt: now,
        deviceId,
        isOnline: true,
        lastLogin: now
      };
    } else {
      updates[`users/${phone}/deviceId`] = deviceId;
      updates[`users/${phone}/isOnline`] = true;
      updates[`users/${phone}/lastLogin`] = now;
    }
    
    updates[`namePhonePairs/${namePairKey}/deviceId`] = deviceId;
    updates[`deviceTracking/${deviceId}/users/${phone}/name`] = name;
    updates[`deviceTracking/${deviceId}/users/${phone}/lastLogin`] = now;
    
    await window.dbUpdate(window.dbRef(window.db), updates);
    
    // Set game state
    gameState.userId = phone;
    gameState.userName = name;
    gameState.userPhone = phone;
    gameState.balance = userSnap.exists() ? (userSnap.val().balance || 0) : 0;
    
    // Update UI
    document.getElementById('displayName').textContent = gameState.userName;
    document.getElementById('displayPhone').textContent = phone;
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('gameScreen').classList.remove('hidden');
    
    // Initialize game
    listenToUserData(phone);
    listenToDepositRequests();
    listenToWithdrawRequests();
    initializeGrid();
    updateDisplay();
    updateDepositButtonState();
    updateWithdrawButtonState();
    
    // Start timers
    startDepositLockTimer();
    
    showMessage('Login successful!', 'success');
    
  } catch (e) {
    console.error(e);
    showMessage('Login failed!', 'error');
  }
}

function handleLogout() {
  if (confirm('Are you sure you want to logout?')) {
    try {
      window.dbUpdate(window.dbRef(window.db, `users/${gameState.userPhone}`), {
        isOnline: false,
        deviceId: null
      });
    } catch (e) { }
    
    if (depositLockTimer) clearInterval(depositLockTimer);
    location.reload();
  }
}

function showKickedScreen() {
  document.getElementById('kickedOverlay').classList.add('active');
}

// Game Grid Functions
function initializeGrid() {
  const grid = document.getElementById('gameGrid');
  grid.innerHTML = '';
  
  for (let i = 0; i < 25; i++) {
    const tile = document.createElement('div');
    tile.className = 'tile';
    tile.onclick = () => clickTile(i);
    grid.appendChild(tile);
  }
}

function clickTile(index) {
  if (gameState.revealedTiles.includes(index)) return;
  
  if (!gameState.gameActive) {
    if (gameState.currentBet === 0) {
      playSound('error');
      showMessage('Set bet first!', 'error');
      return;
    }
    startGame();
  }
  
  gameState.tilesClicked = true;
  gameState.revealedTiles.push(index);
  const tiles = document.querySelectorAll('.tile');
  
  if (gameState.minePositions.includes(index)) {
    playSound('mine');
    tiles[index].textContent = 'ğŸ’£';
    tiles[index].classList.add('revealed', 'mine');
    gameOver(false);
  } else {
    playSound('success');
    tiles[index].textContent = 'ğŸ’';
    tiles[index].classList.add('revealed', 'safe');
    gameState.currentWin += Math.floor(gameState.currentBet * getWinRate());
    updateDisplay();
    document.getElementById('cashoutBtn').disabled = false;
  }
}

function startGame() {
  playSound('click');
  gameState.gameActive = true;
  gameState.minePositions = [];
  gameState.revealedTiles = [];
  gameState.currentWin = 0;
  
  // Generate random mine positions
  while (gameState.minePositions.length < gameState.minesCount) {
    const p = Math.floor(Math.random() * 25);
    if (!gameState.minePositions.includes(p)) {
      gameState.minePositions.push(p);
    }
  }
  
  updateDisplay();
}

async function cashout() {
  if (!gameState.gameActive || gameState.currentWin === 0) return;
  
  playSound('win');
  const total = gameState.currentBet + gameState.currentWin;
  gameState.balance += total;
  
  await updateUserBalance(gameState.userPhone, gameState.balance);
  
  gameState.currentBet = 0;
  gameState.currentWin = 0;
  gameState.gameActive = false;
  gameState.betSet = false;
  gameState.tilesClicked = false;
  
  document.getElementById('cashoutBtn').disabled = true;
  updateDisplay();
  revealAllTiles();
  
  showMessage(`Cashed out Rs ${total}! ğŸ‰`, 'success');
}

function gameOver(won) {
  if (!won) playSound('error');
  
  gameState.gameActive = false;
  gameState.currentBet = 0;
  gameState.currentWin = 0;
  gameState.betSet = false;
  gameState.tilesClicked = false;
  
  document.getElementById('cashoutBtn').disabled = true;
  updateDisplay();
  revealAllTiles();
  
  if (!won) {
    showMessage('Game Over! ğŸ’”', 'error');
  }
}

function revealAllTiles() {
  document.querySelectorAll('.tile').forEach((tile, i) => {
    if (!tile.classList.contains('revealed')) {
      tile.classList.add('revealed');
      if (gameState.minePositions.includes(i)) {
        tile.textContent = 'ğŸ’£';
        tile.classList.add('mine');
      } else {
        tile.textContent = 'ğŸ’';
        tile.classList.add('safe');
      }
    }
  });
}

async function resetGame() {
  playSound('click');
  
  if (gameState.betSet && gameState.currentBet > 0) {
    const ret = gameState.currentBet + gameState.currentWin;
    gameState.balance += ret;
    
    await updateUserBalance(gameState.userPhone, gameState.balance);
    
    showMessage(
      gameState.tilesClicked
        ? `Rs ${gameState.currentBet} (bet) + Rs ${gameState.currentWin} (win) refunded!`
        : `Rs ${gameState.currentBet} refunded!`,
      'success'
    );
  }
  
  gameState.gameActive = false;
  gameState.currentWin = 0;
  gameState.currentBet = 0;
  gameState.minePositions = [];
  gameState.revealedTiles = [];
  gameState.betSet = false;
  gameState.tilesClicked = false;
  
  document.getElementById('cashoutBtn').disabled = true;
  initializeGrid();
  updateDisplay();
}

function updateDisplay() {
  document.getElementById('balance').textContent = gameState.balance;
  document.getElementById('win').textContent = gameState.currentWin;
  document.getElementById('betDisplay').textContent = gameState.currentBet;
  document.getElementById('minesDisplay').textContent = gameState.minesCount;
}

// Modal Functions
function openBetModal() {
  playSound('click');
  
  if (gameState.gameActive) {
    showMessage('Cannot change bet during active game!', 'error');
    return;
  }
  
  document.getElementById('betInput').value = gameState.currentBet || '';
  document.getElementById('betModal').classList.add('active');
}

async function setBet() {
  const amount = parseInt(document.getElementById('betInput').value);
  
  if (!amount || amount < 100 || amount > 10000) {
    showMessage('Bet must be Rs 100â€“10,000', 'error');
    return;
  }
  
  if (gameState.betSet && gameState.currentBet === amount) {
    showMessage('Bet already set with this amount!', 'error');
    return;
  }
  
  if (gameState.betSet && gameState.currentBet > 0 && gameState.currentBet !== amount) {
    gameState.balance += gameState.currentBet;
  }
  
  if (amount > gameState.balance) {
    showMessage('Insufficient balance!', 'error');
    return;
  }
  
  playSound('click');
  gameState.balance -= amount;
  gameState.currentBet = amount;
  gameState.betSet = true;
  gameState.tilesClicked = false;
  
  await updateUserBalance(gameState.userPhone, gameState.balance);
  
  updateDisplay();
  closeModal('betModal');
  showMessage('Bet set! Start playing!', 'success');
}

function openMinesModal() {
  playSound('click');
  
  if (gameState.gameActive) {
    showMessage('Cannot change mines during game!', 'error');
    return;
  }
  
  document.getElementById('minesInput').value = gameState.minesCount;
  document.getElementById('minesModal').classList.add('active');
}

function setMines() {
  const count = parseInt(document.getElementById('minesInput').value);
  
  if (!count || count < 1 || count > 24) {
    showMessage('Mines must be 1â€“24', 'error');
    return;
  }
  
  playSound('click');
  gameState.minesCount = count;
  updateDisplay();
  closeModal('minesModal');
}

// Deposit System
async function checkDepositLock() {
  try {
    const userSnap = await window.dbGet(window.dbRef(window.db, `users/${gameState.userPhone}`));
    if (!userSnap.exists()) return { locked: false };
    
    const user = userSnap.val();
    const rejections = user.depositRejections || 0;
    const lockUntil = user.depositLockUntil || 0;
    const now = Date.now();
    
    if (rejections >= 3 && now < lockUntil) {
      return {
        locked: true,
        lockUntil: lockUntil,
        remaining: Math.ceil((lockUntil - now) / 1000)
      };
    }
    
    if (rejections >= 3 && now >= lockUntil) {
      await window.dbUpdate(window.dbRef(window.db, `users/${gameState.userPhone}`), {
        depositRejections: 0,
        depositLockUntil: null
      });
      return { locked: false, reset: true };
    }
    
    return { locked: false };
  } catch (e) {
    console.error('Check deposit lock error:', e);
    return { locked: false };
  }
}

async function getPendingDeposit() {
  try {
    const snapshot = await window.dbGet(window.dbRef(window.db, 'depositRequests'));
    if (!snapshot.exists()) return null;
    
    let pendingDeposit = null;
    snapshot.forEach(child => {
      const req = child.val();
      if (req.phone === gameState.userPhone && req.status === 'pending') {
        pendingDeposit = { id: child.key, ...req };
      }
    });
    
    return pendingDeposit;
  } catch (e) {
    console.error('Get pending deposit error:', e);
    return null;
  }
}

async function updateDepositButtonState() {
  const depositBtn = document.getElementById('depositBtn');
  const pendingStatus = document.getElementById('pendingDepositStatus');
  
  try {
    const pendingDeposit = await getPendingDeposit();
    const lockStatus = await checkDepositLock();
    
    if (pendingDeposit) {
      depositBtn.textContent = 'â³ PENDING';
      depositBtn.disabled = false;
      
      pendingStatus.classList.add('active');
      document.getElementById('pendingDepositAmount').textContent = 'Rs ' + pendingDeposit.amount;
      document.getElementById('pendingDepositMethod').textContent =
        pendingDeposit.paymentMethod === 'jazzcash' ? 'JazzCash' : 'Easypaisa';
      
      if (lockStatus.locked) {
        const minutes = Math.floor(lockStatus.remaining / 60);
        const seconds = lockStatus.remaining % 60;
        document.getElementById('depositLockTimer').textContent =
          `ğŸ”’ Locked: ${minutes}:${seconds.toString().padStart(2, '0')} remaining`;
      } else {
        document.getElementById('depositLockTimer').textContent = '';
      }
    } else {
      depositBtn.textContent = 'DEPOSIT';
      depositBtn.disabled = false;
      pendingStatus.classList.remove('active');
      
      if (lockStatus.locked) {
        depositBtn.disabled = true;
        depositBtn.textContent = 'ğŸ”’ LOCKED';
        
        pendingStatus.classList.add('active');
        const minutes = Math.floor(lockStatus.remaining / 60);
        const seconds = lockStatus.remaining % 60;
        document.getElementById('depositLockTimer').textContent =
          `ğŸ”’ Locked: ${minutes}:${seconds.toString().padStart(2, '0')} remaining`;
        document.getElementById('pendingDepositAmount').textContent = 'Deposit Locked';
        document.getElementById('pendingDepositMethod').textContent = 'Too many rejected requests';
      }
    }
  } catch (e) {
    console.error('Update deposit button error:', e);
  }
}

function listenToDepositRequests() {
  window.dbOnValue(window.dbRef(window.db, 'depositRequests'), snapshot => {
    updateDepositButtonState();
  });
}

function startDepositLockTimer() {
  if (depositLockTimer) clearInterval(depositLockTimer);
  
  depositLockTimer = setInterval(async () => {
    await updateDepositButtonState();
  }, 1000);
}

function openDepositModal() {
  playSound('click');
  
  // Reset form
  depositMethod = 'jazz';
  document.getElementById('depositAmount').value = '';
  
  // Create payment method toggle
  const toggleHtml = `
    <div style="display: flex; gap: 0; margin-bottom: 20px; background: rgba(8,10,18,0.6); border: 1.5px solid rgba(255,255,255,0.1); border-radius: 8px; overflow: hidden;">
      <button id="depTabJazz" style="flex: 1; padding: 12px; background: rgba(52,211,153,0.18); color: var(--neon-emerald); border: none; cursor: pointer;" onclick="switchDepositMethod('jazz')">JazzCash</button>
      <button id="depTabEasy" style="flex: 1; padding: 12px; background: transparent; color: var(--text-muted); border: none; cursor: pointer;" onclick="switchDepositMethod('easy')">Easypaisa</button>
    </div>
  `;
  
  document.querySelector('#depositModal .payment-method-toggle').innerHTML = toggleHtml;
  
  // Create payment number display
  const numberHtml = `
    <div style="background: rgba(8,10,18,0.65); border: 1.5px solid rgba(240,192,64,0.3); border-radius: 8px; padding: 16px; text-align: center; cursor: pointer; transition: all 0.3s ease;">
      <div style="font-family: 'Orbitron', sans-serif; font-size: 20px; font-weight: 700; color: var(--gold); letter-spacing: 2px; margin: 8px 0; text-shadow: 0 0 8px rgba(240,192,64,0.3);" id="depositNumber">03266916283</div>
      <div style="font-size: 14px; color: var(--neon-emerald); direction: rtl; margin-top: 8px;">Ù†Ù…Ø¨Ø± Ú©Ø§Ù¾ÛŒ Ú©Ø± Ú©Û’ Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ú©Ø±ÛŒÚºÛ”</div>
    </div>
  `;
  
  document.querySelector('#depositModal .payment-number-display').innerHTML = numberHtml;
  document.querySelector('#depositModal .payment-number-display').onclick = copyDepositNumber;
  
  // Initialize with JazzCash
  switchDepositMethod('jazz');
  
  // Check lock status
  checkDepositLock().then(lockStatus => {
    const cooldownEl = document.getElementById('depositCooldown');
    if (lockStatus.locked) {
      const minutes = Math.floor(lockStatus.remaining / 60);
      const seconds = lockStatus.remaining % 60;
      cooldownEl.style.display = 'block';
      cooldownEl.textContent = `ğŸ”’ Locked for ${minutes}:${seconds.toString().padStart(2, '0')} (3 rejected requests)`;
    } else {
      cooldownEl.style.display = 'none';
    }
  });
  
  document.getElementById('depositModal').classList.add('active');
}

function switchDepositMethod(method) {
  playSound('click');
  depositMethod = method;
  const tabJ = document.getElementById('depTabJazz');
  const tabE = document.getElementById('depTabEasy');
  const numberEl = document.getElementById('depositNumber');
  
  if (method === 'jazz') {
    tabJ.style.background = 'rgba(52,211,153,0.18)';
    tabJ.style.color = 'var(--neon-emerald)';
    tabE.style.background = 'transparent';
    tabE.style.color = 'var(--text-muted)';
    numberEl.textContent = '03266916283';
  } else {
    tabE.style.background = 'rgba(251,191,36,0.16)';
    tabE.style.color = 'var(--neon-amber)';
    tabJ.style.background = 'transparent';
    tabJ.style.color = 'var(--text-muted)';
    numberEl.textContent = '03193433587';
  }
}

function copyDepositNumber() {
  const number = document.getElementById('depositNumber').textContent;
  const display = document.querySelector('#depositModal .payment-number-display');
  
  if (navigator.clipboard) {
    navigator.clipboard.writeText(number).then(() => {
      display.style.borderColor = 'var(--neon-emerald)';
      display.style.background = 'rgba(52,211,153,0.1)';
      setTimeout(() => {
        display.style.borderColor = 'rgba(240,192,64,0.3)';
        display.style.background = 'rgba(8,10,18,0.65)';
      }, 2000);
      playSound('success');
    }).catch(err => {
      console.error('Copy failed:', err);
    });
  }
}

async function submitDeposit() {
  playSound('click');
  
  const amount = parseInt(document.getElementById('depositAmount').value);
  const method = depositMethod === 'jazz' ? 'jazzcash' : 'easypaisa';
  
  if (!amount || amount < 500) {
    showMessage('Minimum deposit amount is Rs 500', 'error');
    return;
  }
  
  const lockStatus = await checkDepositLock();
  if (lockStatus.locked) {
    const minutes = Math.floor(lockStatus.remaining / 60);
    const seconds = lockStatus.remaining % 60;
    showMessage(`Deposit locked! Wait ${minutes}:${seconds.toString().padStart(2, '0')}`, 'error');
    return;
  }
  
  const pendingDeposit = await getPendingDeposit();
  if (pendingDeposit) {
    showMessage('You already have a pending deposit request', 'error');
    return;
  }
  
  try {
    const requestRef = window.dbPush(window.dbRef(window.db, 'depositRequests'));
    await window.dbSet(requestRef, {
      id: requestRef.key,
      userId: gameState.userPhone,
      name: gameState.userName,
      phone: gameState.userPhone,
      amount: amount,
      paymentMethod: method,
      status: 'pending',
      timestamp: Date.now(),
      createdAt: window.dbServerTimestamp()
    });
    
    showMessage('âœ… Deposit request submitted successfully!\nAdmin will approve soon.', 'success');
    closeModal('depositModal');
  } catch (e) {
    console.error('Submit deposit error:', e);
    showMessage('âŒ Failed to submit deposit request', 'error');
  }
}

// Withdraw System
async function getPendingWithdraw() {
  try {
    const snapshot = await window.dbGet(window.dbRef(window.db, 'withdrawRequests'));
    if (!snapshot.exists()) return null;
    
    let pendingWithdraw = null;
    snapshot.forEach(child => {
      const req = child.val();
      if (req.phone === gameState.userPhone && req.status === 'pending') {
        pendingWithdraw = { id: child.key, ...req };
      }
    });
    
    return pendingWithdraw;
  } catch (e) {
    console.error('Get pending withdraw error:', e);
    return null;
  }
}

async function updateWithdrawButtonState() {
  const withdrawBtn = document.getElementById('withdrawBtn');
  const pendingStatus = document.getElementById('pendingWithdrawStatus');
  
  try {
    const pendingWithdraw = await getPendingWithdraw();
    
    if (pendingWithdraw) {
      withdrawBtn.textContent = 'â³ PENDING';
      withdrawBtn.disabled = false;
      
      pendingStatus.classList.add('active');
      document.getElementById('pendingWithdrawAmount').textContent = 'Rs ' + pendingWithdraw.amount;
      document.getElementById('pendingWithdrawMethod').textContent =
        pendingWithdraw.withdrawMethod === 'jazz' ? 'JazzCash' : 'Easypaisa';
      document.getElementById('pendingWithdrawNumber').textContent =
        'To: ' + pendingWithdraw.jazzCash;
    } else {
      withdrawBtn.textContent = 'WITHDRAW';
      withdrawBtn.disabled = false;
      pendingStatus.classList.remove('active');
    }
  } catch (e) {
    console.error('Update withdraw button error:', e);
  }
}

function listenToWithdrawRequests() {
  window.dbOnValue(window.dbRef(window.db, 'withdrawRequests'), snapshot => {
    updateWithdrawButtonState();
  });
}

function checkWithdrawCooldown() {
  const last = localStorage.getItem(`lastWithdraw_${gameState.userPhone}`);
  if (last) {
    const elapsed = Date.now() - parseInt(last);
    const cooldown = 2 * 60 * 60 * 1000; // 2 hours
    if (elapsed < cooldown) {
      return {
        allowed: false,
        remaining: Math.ceil((cooldown - elapsed) / 60000)
      };
    }
  }
  return { allowed: true };
}

function openWithdrawModal() {
  playSound('click');
  
  // Reset form
  withdrawMethod = 'jazz';
  document.getElementById('withdrawPhone').value = '';
  document.getElementById('withdrawAmount').value = '';
  
  // Create payment method toggle
  const toggleHtml = `
    <div style="display: flex; gap: 0; margin-bottom: 20px; background: rgba(8,10,18,0.6); border: 1.5px solid rgba(255,255,255,0.1); border-radius: 8px; overflow: hidden;">
      <button id="withdrawTabJazz" style="flex: 1; padding: 12px; background: rgba(52,211,153,0.18); color: var(--neon-emerald); border: none; cursor: pointer;" onclick="switchWithdrawMethod('jazz')">JazzCash</button>
      <button id="withdrawTabEasy" style="flex: 1; padding: 12px; background: transparent; color: var(--text-muted); border: none; cursor: pointer;" onclick="switchWithdrawMethod('easy')">Easypaisa</button>
    </div>
  `;
  
  document.querySelector('#withdrawModal .payment-method-toggle').innerHTML = toggleHtml;
  
  // Initialize with JazzCash
  switchWithdrawMethod('jazz');
  
  // Check cooldown
  const cooldown = checkWithdrawCooldown();
  const cooldownEl = document.getElementById('withdrawCooldown');
  if (!cooldown.allowed) {
    const hours = Math.floor(cooldown.remaining / 60);
    const minutes = cooldown.remaining % 60;
    cooldownEl.style.display = 'block';
    cooldownEl.textContent = `â³ Wait ${hours}h ${minutes}m before next withdraw`;
  } else {
    cooldownEl.style.display = 'none';
  }
  
  document.getElementById('withdrawModal').classList.add('active');
}

function switchWithdrawMethod(method) {
  playSound('click');
  withdrawMethod = method;
  const tabJ = document.getElementById('withdrawTabJazz');
  const tabE = document.getElementById('withdrawTabEasy');
  const input = document.getElementById('withdrawPhone');
  
  if (method === 'jazz') {
    tabJ.style.background = 'rgba(52,211,153,0.18)';
    tabJ.style.color = 'var(--neon-emerald)';
    tabE.style.background = 'transparent';
    tabE.style.color = 'var(--text-muted)';
    input.placeholder = 'JazzCash 03XXXXXXXXX';
  } else {
    tabE.style.background = 'rgba(251,191,36,0.16)';
    tabE.style.color = 'var(--neon-amber)';
    tabJ.style.background = 'transparent';
    tabJ.style.color = 'var(--text-muted)';
    input.placeholder = 'Easypaisa 03XXXXXXXXX';
  }
}

async function submitWithdraw() {
  playSound('click');
  
  const phone = document.getElementById('withdrawPhone').value.trim();
  const amount = parseInt(document.getElementById('withdrawAmount').value);
  
  if (!/^03[0-9]{9}$/.test(phone)) {
    showMessage(withdrawMethod === 'jazz' ? 'Invalid JazzCash number!' : 'Invalid Easypaisa number!', 'error');
    return;
  }
  
  if (!amount || amount < 1000) {
    showMessage('Minimum withdraw amount is Rs 1000', 'error');
    return;
  }
  
  if (amount > gameState.balance) {
    showMessage('Insufficient balance!', 'error');
    return;
  }
  
  const cooldown = checkWithdrawCooldown();
  if (!cooldown.allowed) {
    const hours = Math.floor(cooldown.remaining / 60);
    const minutes = cooldown.remaining % 60;
    showMessage(`â³ Wait ${hours}h ${minutes}m before next withdraw`, 'error');
    return;
  }
  
  const pendingWithdraw = await getPendingWithdraw();
  if (pendingWithdraw) {
    showMessage('You already have a pending withdraw request', 'error');
    return;
  }
  
  try {
    const requestRef = window.dbPush(window.dbRef(window.db, 'withdrawRequests'));
    await window.dbSet(requestRef, {
      id: requestRef.key,
      userId: gameState.userPhone,
      name: gameState.userName,
      phone: gameState.userPhone,
      jazzCash: phone,
      withdrawMethod: withdrawMethod,
      amount: amount,
      status: 'pending',
      timestamp: Date.now(),
      createdAt: window.dbServerTimestamp()
    });
    
    localStorage.setItem(`lastWithdraw_${gameState.userPhone}`, Date.now().toString());
    
    showMessage('âœ… Withdraw request submitted successfully!\nAdmin will process soon.', 'success');
    closeModal('withdrawModal');
  } catch (e) {
    console.error('Submit withdraw error:', e);
    showMessage('âŒ Failed to submit withdraw request', 'error');
  }
}

// Initialize game when page loads
window.addEventListener('DOMContentLoaded', () => {
  // Check if user is already logged in (for demo purposes)
  // In production, you would check Firebase for existing session
  console.log('Mines Game - Card Edition loaded');
});
</script>

</body>
</html>